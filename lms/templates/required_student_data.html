<%!
from django.utils.translation import ugettext as _
from django.core.urlresolvers import reverse
from django.utils.formats import get_format
%>
<% form = request._required_student_data_form %>
<script>
$(function(){
    var postpone = function(){
        $.post('${ reverse("postpone_required_data_update") }')
        return false;
    }

    $('#send_student_data').basicModal({
        autoOpen: true,
        closeButton: $(this).find('.close-modal'),
        onOpen: function(modal){
        modal.find('.date').css({
            'position': 'relative',
            'z-index': parseInt(modal.css('z-index')) + 1 || 102
         })
         .datepicker('destroy').datepicker({
            changeMonth: true,
            changeYear: true,
            maxDate: '-1Y',
            minDate: '-120Y',
            yearRange: '-120:-1',
            dateFormat: '${ get_format('DATE_INPUT_FORMATS')[0] }'.replace('%Y', 'yy').replace('%y', 'y').replace('%m', 'mm').replace('%d', 'dd'),
            // TODO
            defaultDate: new Date(1988, 6, 15),
            firstDay: 1,
            dayNamesMin: ["${_('Su')}", "${_('Mo')}", "${_('Tu')}", "${_('We')}", "${_('Th')}", "${_('Fr')}", "${_('Sa')}"],
            dayNames: ["${_('Sunday')}", "${_('Monday')}", "${_('Tuesday')}", "${_('Wednesday')}", "${_('Thursday')}", "${_('Friday')}", "${_('Saturday')}"],
            monthNamesShort: ["${_('Jan')}", "${_('Feb')}", "${_('Mar')}", "${_('Apr')}", "${_('May')}", "${_('Jun')}", "${_('Jul')}", "${_('Aug')}", "${_('Sep')}", "${_('Oct')}", "${_('Nov')}", "${_('Dec')}"],
            monthNames: ["${_('January')}", "${_('February')}", "${_('March')}", "${_('April')}", "${_('May')}", "${_('June')}", "${_('July')}", "${_('August')}", "${_('September')}", "${_('October')}", "${_('November')}", "${_('December')}"]
        });
        },
        onUserClose: postpone
    });

    $('#required_student_data_form').ajaxForm({
        onSuccess: function(){
            $('#send_student_data').basicModal('close');
        },
        onCancel: function(){
            postpone();
            $('#send_student_data').basicModal('close');
        },
        errorClass: 'modal-form-error'
    });

  });
</script>
<section id="send_student_data" class="modal" aria-hidden="true">
  <div class="inner-wrapper" role="dialog" aria-labelledby="user-data-title">
    <button class="close-modal">
      <i class="icon-remove"></i>
      <span class="sr">
        ${_('Submit later')}
      </span>
    </button>

    <header>
      <h2 id="user-data-title">
        ${_("Personal information")}
        <span class="sr">,
          ## Translators: this text gives status on if the modal interface (a menu or piece of UI that takes the full focus of the screen) is open or not
          ${_("window open")}
        </span>
      </h2>
      <hr/>
    </header>
    <div id="student_data_body">
      <form id="required_student_data_form" action="${ reverse("update_required_data") }">
        <p>${_("Please type in your personal information for issuing your certificate of completion")}<p>
        <p>* ${_('All the fields are required')}</p>
        <br>
        <fieldset>
          <div class="input-group">
            <div class="non_field_errors"></div>
            <label>${_("First name")}:</label>
            ${ form['first_name'] }
            <div id="${ form['first_name'].auto_id }_error"></div>
            <label>${_("Last name")}:</label>
            ${ form['last_name'] }
            <div id="${ form['first_name'].auto_id }_error"></div>
            <label>${_("Date of birth")}:</label>
            ${ form['birthdate'] }
            <div id="${ form['birthdate'].auto_id }_error"></div>
          </div>
          <div class="submit submit-cancel">
            <input type="submit" id="submit" value="${_('Save')}">
            <input type="button" id="postpone" class="cancel" value="${_('Submit later')}">
          </div>
        </fieldset>
      </form>
    </div>
  </div>
</section>
